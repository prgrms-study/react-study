## 1.23 Immer λ¥Ό μ‚¬μ©ν• λ” μ‰¬μ΄ λ¶λ³€μ„± κ΄€λ¦¬

### intro

λ¦¬μ•΅νΈμ—μ„ λ°°μ—΄μ΄λ‚ κ°μ²΄λ¥Ό μ—…λ°μ΄νΈ ν•΄μ•Ό ν•  λ•μ—λ” μ§μ ‘ μμ • ν•λ©΄ μ•λκ³  λ¶λ³€μ„±μ„ μ§€μΌμ£Όλ©΄μ„ μ—…λ°μ΄νΈλ¥Ό ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

- κ°μ²΄

```js
const object = {
  a: 1,
  b: 2
};

const nextObject = {
  ...object,
  b: 3
};
```



- λ°°μ—΄

λ°°μ—΄λ„ λ§μ°¬κ°€μ§€λ΅, `push`, `splice` λ“±μ ν•¨μλ¥Ό μ‚¬μ©ν•κ±°λ‚ n λ²μ§Έ ν•­λ©μ„ μ§μ ‘ μμ •ν•λ©΄ μ•λκ³ 

 `concat`, `filter`, `map` λ“±μ ν•¨μλ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.



> π’΅ λ°μ΄ν„° κµ¬μ΅°κ°€ κΉλ‹¤λ΅μ›μ§€λ©΄ λ¶λ³€μ„±μ„ μ§€ν‚¤λ©΄μ„ μƒλ΅μ΄ λ°°μ—΄, κ°μ²΄λ¥Ό μƒμ„±ν•λ”κ² κΉλ‹¤λ΅μ› μ§„λ‹¤.



### Immerλ€?

Immer λ¥Ό μ‚¬μ©ν•λ©΄ μ°λ¦¬κ°€ μƒνƒλ¥Ό μ—…λ°μ΄νΈ ν•  λ•, λ¶λ³€μ„±μ„ μ‹ κ²½μ“°μ§€ μ•μΌλ©΄μ„ μ—…λ°μ΄νΈλ¥Ό ν•΄μ£Όλ©΄ Immer κ°€ λ¶λ³€μ„± κ΄€λ¦¬λ¥Ό λ€μ‹  ν•΄μ¤λ‹λ‹¤.



- immer μ„¤μΉ

```shell
$ yarn add immer
```



- `produce` ν•¨μ

μ²«λ²μ§Έ νλΌλ―Έν„° : μμ •ν•κ³  μ‹¶μ€ μƒνƒ

λ‘λ²μ§Έ νλΌλ―Έν„° : μ–΄λ–»κ² μ—…λ°μ΄νΈν•κ³  μ‹¶μ„μ§€ μ •μν•λ” ν•¨μ

```js
import produce from 'immer';

const state = {
  number: 1,
  dontChangeMe: 2
};

const nextState = produce(state, draft => {
  draft.number += 1;
});

console.log(nextState);
// { number: 2, dontChangeMe: 2 }
```



### μμ 

```javascript
const initialState = {
  users: [
    {
      id: 1,
      username: 'velopert',
      email: 'public.velopert@gmail.com',
      active: true
    },
    {
      id: 2,
      username: 'tester',
      email: 'tester@example.com',
      active: false
    },
    {
      id: 3,
      username: 'liz',
      email: 'liz@example.com',
      active: false
    }
  ]
};

function reducer(state, action) {
  switch (action.type) {
    case 'CREATE_USER':
      return produce(state, draft => {
        draft.users.push(action.user);
      });
    case 'TOGGLE_USER':
      return produce(state, draft => {
        const user = draft.users.find(user => user.id === action.id);
        user.active = !user.active;
      });
    case 'REMOVE_USER':
      return produce(state, draft => {
        const index = draft.users.findIndex(user => user.id === action.id);
        draft.users.splice(index, 1);
      });
    default:
      return state;
  }
}
```



### Immer μ™€ ν•¨μν• μ—…λ°μ΄νΈ

>  **ν•¨μν• μ—…λ°μ΄νΈμ μ΄μ **
>
>  `useCallback` μ„ μ‚¬μ©ν•λ” κ²½μ° μμ΅΄μ„±μ„ λ…μ‹ν•μ§€ μ•μ•„λ„ λλ‹¤.



π’΅ ν•¨μν• μ—…λ°μ΄νΈλ¥Ό ν•λ” κ²½μ°μ—, Immer λ¥Ό μ‚¬μ©ν•λ©΄ μƒν™©μ— λ”°λΌ λ” νΈν•κ² μ½”λ“λ¥Ό μ‘μ„±ν•  μ μλ‹¤.

- `produce` ν•¨μμ— λ‘κ°μ νλΌλ―Έν„°λ¥Ό λ„£κ² λλ‹¤λ©΄, μ²«λ²μ§Έ νλΌλ―Έν„°μ— λ„£μ€ μƒνƒλ¥Ό λ¶λ³€μ„±μ„ μ μ§€ν•λ©΄μ„ μƒλ΅μ΄ μƒνƒλ¥Ό λ§λ“¤μ–΄μ¤€λ‹¤.

-  λ§μ•½μ— μ²«λ²μ§Έ νλΌλ―Έν„°λ¥Ό μƒλµν•κ³  λ°”λ΅ μ—…λ°μ΄νΈ ν•¨μλ¥Ό λ„£μ–΄μ£Όκ² λλ‹¤λ©΄, λ°ν™ κ°’μ€ μƒλ΅μ΄ μƒνƒκ°€ μ•„λ‹ μƒνƒλ¥Ό μ—…λ°μ΄νΈ ν•΄μ£Όλ” ν•¨μκ°€ λλ‹¤.

```js
const todo = {
  text: 'Hello',
  done: false
};

const updater = produce(draft => {
  draft.done = !draft.done;
});

const nextTodo = updater(todo);

console.log(nextTodo);
// { text: 'Hello', done: true }
```



κ²°κµ­ `produce` κ°€ λ°ν™ν•λ”κ²ƒμ΄ μ—…λ°μ΄νΈ ν•¨μκ°€ λκΈ° λ•λ¬Έμ— `useState` μ μ—…λ°μ΄νΈ ν•¨μλ¥Ό μ‚¬μ© ν•  λ–„ λ‹¤μκ³Ό κ°™μ΄ κµ¬ν„ ν•  μ μκ² λλ‹¤.

```js
const [todo, setTodo] = useState({
  text: 'Hello',
  done: false
});

const onClick = useCallback(() => {
  setTodo(
    produce(draft => {
      draft.done = !draft.done;
    })
  );
}, []);
```



### λ§λ¬΄λ¦¬

- μ–Έμ λ‚ κ·Έλ¬λ“―μ΄ μ μ¬μ μ†μ— μ‚¬μ©
- μ„±λ¥μ€ λ„¤μ΄ν‹°λΈκ°€ μΆ‹λ‹¤.